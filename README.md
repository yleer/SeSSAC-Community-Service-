# SeSSAC-Community-Service-
2021 final assignment.

## SeSac Community Service에 관하여
이 어플은 새싹(iOS 공부) 커뮤니티를 구현한 어플입니다. 간단한 회원가입 절차를 통해 아이디를 생성하고, 생성한 아이디를 통해 글을 작성하며, 다른 사람들이 작성한 글들을 볼 수 있습니다.
마음에 드는 게시글이 있으면 게시글에 댓글을 달 수 있으며, 자신이 작성한 게시글 그리고 댓글에 대하여 수정과 삭제가 가능합니다. 

## 사용 기술
* UrlSession
* Alamofire
* SnapKit
* Pagenation

## 이슈
1. 게시글 안에서 post 콜을 통해 댓글을 작성하면, 가장 최신의 댓글인 자신의 댓글을 보여게끔 하는 기능을 구현하려고 했습니다. 이 기능을 구현하기 위해 새로운 댓글 작성 후 get콜을 통해 댓글들을 다시 불러드려 마지막 댓글로 scrollToRow을 하였습니다. 하지만 게시글 내용을 갱신 후 scrollToRow을 통해 마지막 댓글로 이동을 했지만, 자꾸 맨 마지막 위에 댓글로 이동되는 문제가 있었습니다.
2. Pagnation을 구현하는데 있어, 게시판 내용을 새로고침을 하다 보면 어느 순간 tableview의 indexPath 개수의 차이로 에러가 나는 문제가 있었습니다. 이 문제는 어느 때에는 잘 되다가 게시판을 아래로 스크롤을 많이 내려 pagenation이 진행되다 새로고침을 할때 에러가 생겼습니다. 



## 해결방법
1. 마지막이 아닌 하나 위 댓글로 이동이 계속 되자, scrollToRow이 불리기 전 댓글의 개수를 확인했습니다. 확인을 하니 댓글의 총 개수가 post콜을 통해 작성한 새로운 댓글이 포함되지 않은 개수인 것을 확인했습니다. 분명 scrollTo보다 먼저 get call을 실행하였기 때문에 당연히 scrollTo가 다음에 실행될 줄 알았지만, 네트워크 통신의 비동기성 때문에 scrollTo가 불리기 전에 댓글들이 업데이트 되지 않는 것을 알게되었습니다. 이를 해결하기 위해 get call에 completion 핸들러를 추가해주어 통신이 끝나면 reloadData를 실행 후, scrollTo가 실행되게끔 코드를 수정하였습니다.

2. 이를 해결하기 위해 총 개시글의 개수와 tableview에서 보여주는 마지막 indexPath를 비교하여 보니 둘이 다른 값을 가지고 있는 것을 파악했지만, 어느 쪽이 문제인지를 알기에 쉽지 않았습니다. 하지만 결국에는 서로간의 데이터가 맞지 않아 일어나는 일임을 파악하고 get 콜을 하는 부분을 자세히 보게 되었습니다. 그렇게 보니 새로고침을 통한 get 콜일때 마다 게시글 배열을 초기화 하고, 그 후 get의 결과를 넣어주는 방식으로 되어 있었는데 이 부분은 네트워크 통신으로 비동기적으로 작동하기 때문에 새로고침에서 reloadData와 비동기적으로 온 데이터의 차이로 인한 문제인 것을 확인하게 되었습니다. 그래서 이 부분에 빈 배열로 초기화 하는 부분을 빼고 completion handler에서 온 데이터를 바로 게시글에 대입하는 것으로 이 문제를 해결할 수 있었습니다.
